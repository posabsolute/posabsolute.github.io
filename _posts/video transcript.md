[Music] [Applause] [Music] [Applause] [Music] [Applause] [Music]

hello everyone oh that's interesting all right uh yeah I'm Cedric I work at a company called ad where I UI it's a company of around 250 Engineers distributed in four different offices uh we've been doing micro frontend for more than a year now in production so I'm going to talk about that we have 30 micro frontend currently running into one products and uh yeah we use modu Federation so we're going to talk about our usage of mod Federation to manage all this so here's the game plan so first I'm going to just do a little bit of an introduction about micro frontend and why we needed it um I know there's like multiple talks about micro I'm going to try to go fast around that and then we're going to see uh what is web pack moderation how it works I'll show you an example in production so actually the code of abir and seeing how it runs then we're going to talk about uh some Advanced considerations things like deployment design consistency and service side rendering and finally uh I'm going to tell you what I think about it and should you use it and it's gonna be my opinion so if you you know look at the uh comments on a new you'll see there's a broad uh Broad people think different things so this be my opinion using it but obviously uh you can do your own research afterwards so okay micro uh just a bit of introduction in that Chanel I works right so uh the idea of micro comes uh in in one way so you have it's the idea of like we have one large application uh we want to split that in multiple independent uh applications in as usual setup going to have your container applications which going to be uh maintaining the state of the page knows about all the other microfrontends basically act as a glue for everything uh and then you're G have your independent microfrontends so these microfrontends usually they have their own repo their own cicd deployment pipeline uh and basically it's a it's a way to manage apps but in the same kind of container uh and uh microphone started to be popular around 20 2018 uh in in my opinion it's basically a way to answer how we scale teams and organizations and I'm going to generalize a lot here but like if you look at like startups are they evolve especially like five six years ago like you'll see like you have a small team you have a mallet then you grow a little bit then you start on splitting your front end your back end thinking about more about epis and if you go in more then you think about domains right so you have domain team I want to talk think about spe on the domain and build services and at that point usually what happens is your mail monel it becomes slow it becomes an endurance your productivity and you want to kind of like move to something that enables you to go faster and be a bit more cleaner and usually that's where the services architecture kind of comes into play the problem though for front end is at that point like probably your F applications like a big soup of JavaScript HTML and CSS hwi so how do you move away from that and that's in my opinion what micro for 10 address the pass right it's a way for us to have teams to be completely independent being charge of their own Journey from the front to the back so being able to deploy their own services but also being able to deploy their own front end and be completely in charge of

it so um like why we do that there's multiple advantages why you want to move you want to move to a micro architecture when you have like this big Mallet one is uh because they're complet dependent you have your own Repro they kind of become technology agnostic it depends on your architecture and how you kind of like set it up but what it means basically if your Monet is using react 16 with like old version of Redux you new mic microphone 10 you can basically it's like like new things right so you can do whatever you want so you can use react 18 react quy maybe you don't need Redux at all so your your teams can uh decide to use much better like Tech around it uh and because they do that like you usually have less Tech dep they're in charge of everything in the repo so they understand the state of the complete application and uh because it's small again num probably a out Point like if you think 10 years down the line building an application uh what happens for example for us is that we don't deploy a modet every time someone merged to master right it goes to a state where it goes integration and a week later it's go staging goes and a week later goes production with a setup like this uh what happen is like because the teams are in charge uh of the the repo and their cic pipeline they can decide to merge something to master they apply automatically to integration do a smoke test and then do the other step we go to staging to production automatically so enables things to go much faster in the recycle of building their

applications so yeah that's my introduction on Micron so now we're going to move to uh mod federations so uh how do you do Micron right there's multiple ways uh and usually which before that exists like there was things like oh we're just going to render the application directly in another container but uh two years ago weback introduced something called moded Federation and basically model Federation makes kind of like this idea of micro front first class support inside web pack so how's that work think about your typical reapplication and think of these as blocks right you have components potentially a store libraries think of all of those as independ independent blocks what if uh you could take one of those blocks from one application pass it to the other application but at runtime so when I say at run time it means literally when the browser is loading application 2 he's able to uh call application one pull this file into its own life cycle and use it like any other kind of modules you would have in your no modules or your Source folder and that's basically what modle fedu

allows and you can see like kind of like a a very simple implementation here so uh in mf1 uh and it's to web config so you go to webc config.js you go to the plugin section and then uh you instate the new modification plugin you give it a name it's call if you want could be name anything and then you'll see the the exposers object so in there basically you decide okay in mf1 what I want to expose to other applications so in this case we want to expose a button in mf2 which is the one that's pulling from other applications you do the same thing you go in the uh web config you go in the plugin section you instant sheet mid fation plugin and then instead of exposers you'll see you have the remotes object and basically in remotes you're going to tell every other application that mf2 has access so that it can uh that it can pull uh other modules from and when you do that properly uh you're able to do something like import button from mf1 in your code like it was anything else that was in your no module static on your you know in your build or in your computer like you know you have new mod and Source folder but instead what what modation does when you do that it actually does a HTTP request so in the background there's a lot of magic here but like in the background what it does like you do the import is going to do HTP request to whatever wherever mf1 is pull that in and then make it make this complete transparent to you so for you it's kind of like simple it's just like in your normal workflow but in background really happens is there's an HTP request to a script the script is loaded and after that uh it will basically tell okay like this component is at this location pull it from there and in like give it access to it um yeah two things to to see here one you can see that I'm not importing a micro font in this example I'm importing a button so moderation goes way further than just uh doing being something for micro Fant you can literally import anything you want from an application to another so anything like functions utls a component so in in this example mf1 could be a company Library I want to expose to other applications and other application can pull for it directly from the browser um what would be the advantages of this well for example you have a compound Library you want you have like 30d applications you want an update to this to to your competence terms of starting being automatically in production without having to update the 30 other applications right well with moderation you could do that I'm not saying you should but you could uh you could expose a store like your Redux store could be exposed as uh as something that other application can use so it's basically there there's not a lot of limits there like you can literally expose anything that is part ofation to other application so it's quite interesting ad we use it only into a micro context but you could uh do much more the other thing I wanted to say you can see in mf1 in the remotes here we have mf1 at locost 83 uh obviously that works when you're in Dev that doesn't work when you have like a cicd pipeline and like you can pull from local so you have a couple of options to manage where are your remotes you can put a string uh you can use environment variable potentially to change that strings if you know exactly where it's going to be the CDN for this uh the other option you have is this actually also support a function it's called a promise and a promise and basically the idea is you could do a call when you need to pull your remotes you do an call in your browser uh and basically me is going to request to some API or some Json object somewhere and tells oh tell me where mf1 is right now and be able to load it using that [Music] um yeah the other option that you have there's a third option uh is doing it through code so so uh for pulling remotes like I said you can do it with a string environment variable you can use this promise promise in the we pack config but you can also foro everything of that and just do it directly in your code and I know like it's very very verose this is taken uh this is taken from the uh sorry Mel Federation documentation like directly so I didn't write this and the idea is just to show you that there like there's another way to do it and we do it this way at up because uh and I think I said it but like we're Distributing four different offices I don't control people building micr I just handle the framework so I don't know how many micr going to be so I don't want to have a static list so we're actually pulling that from a Json object and then we pulling all the micr tens and depending on the path we're going to say okay from this path there is this application go load it so doing it through code made much sense for us um and yeah so again like there are examples to do this directly in Federation it's very repos one thing I want to take to your attention is the web web pack in its sharing you may Wonder like what other does that work with application dependencies because for example that button we imported it needs react it might need other things like we don't know so uh moderation handles calling your dependen dependencies for you but you can also decide which one you can share across all the the your uh Federated modules so I mean if we go back here you could have another property here called shared and you can like some some of the examples I see people do it could literally take we could do your package at Json do dependencies right pull that as a Json object and do do dependencies and pass up your new shared property what is that going to do like every time you load um uh F modules you're going to look at the dependencies already loaded use semantic versioning and be able to decide if it needs to pull the other chunks so automatically uh what you mean what what's the advantages well you don't have to like for example like you use react in all your application right you can share react so that like you don't have to repo react every time you Lo a new micr which was what kind of like one of the big issue like before mod Federation is like in terms of packaging your application they're very large application because every time you're having a micro frontend you're you're reing all the dependencies for everything with mobile Federation like the cool thing is like you can share those dependencies it end all semantic versioning for you so that you don't have to care to it although there's a couple of Guta and then we'll see a bit later for that okay so uh we're going to move to the abir example so this is the abir UI just to give you a bit context with the like the yellow and red red and blue lines they're not part of the UI they just like to show you a bit of like how this is structured uh abir Mallet is 15 years old so we're kind of a very old startup we have hundreds of pages in there so um we had to find a way to move out of the Mallet right so the guys that build this like 15 years ago they used uh something it's in Java and they use a front end framework in Java called quicket so uh this is recorded so I won't say what like f Engineers think of Wick at abir but it's not good things so uh like over the years they they went to a lot of cycle it's 15 years so they went to back pH and after that they tried to embed react application in the modet but the problem is still the modet takes 15 minutes just to run like load it locally on your computer right and it's in Java so for frontend engineers it's very difficult to work with so that just like wasn't working uh like for future future use for us so we have to found a way to move away from the completely not just trying to embed react application into it so what we did is a very at typical uh micr front set up so we have a contender application the contenter application I know it's a bit small but like and those the Eder footer the routing navigational components error page Global notification model so everything that com kinds of global to us uh is Ed by the cont application so react application and it's the same concept that I shown you mf2 mf1 like we have uh this is and we're using model fation what we do is every other teams that AB direct they build micr front ends we provide a react water plate so that's it's easy for them to set up that includes like things like you know eslint and like the everything that they need to get ready really faster in integration our CISD pipeline smoke test and all that and we have a CLI they just say oh I want to be this app be name this it's going to be used at this p and then basically after that they need to register with the container application but beside that they're completely independent so it's a very small part of the application if I go back to where UI here so the content application is everything but the blue section and the blue section is our micro front ends um you you can configure this at direct so for example you want to have a full page without any of this you can just uh you can say I don't want any of this and then you have a blank Cass but most of the time you will want those elements and the reason we use this setup is that we found out quite fast at the beginning

we take it it's a the guy that forgot this phone

yeah

okay so uh I was saying that yeah we have a typical uh micro setup here um okay let's move

on well let's go to the

demo okay so this is uh abir um what you see here you have the header the scav is actually part of container everything here is actually a micr 10 from good afternoon CED so me refresh the page I think you can kind of see the the setup from just refreshing that the micro 10 loads afterwards right so I'm going to open the inspector just to see like so you can see a bit like our web pack uh modification is endling all this so go Network JavaScript

refresh so we have index on bundle here and you see it's called micro container we have we call it this way but the container app right so this bundle is loaded on every page that is part uh of you know of the micro frontend setup and then after that depending on the PAAD uh this will go and load the remote entry thats for the micro so this is like SL admin remote entry so this is a micro package with model Federation and basically from there uh budet Federation will do its own thing on pulling your bundles this is bundles taken from uh that it knows it needs to load to load this micr font and the more you share dependencies the more is going to split that into chunks right so and identify this chunks with what are dependencies in there so that it doesn't have to reload those things if it already loaded and just to give you an example like if I go here team manager like this is part of the uh mamed if I go back this is part of the container plus microphone 10 so one is in react completely one is in Java Plus like some react stuff so it was important for us that like the kind of the look stay exactly the same as you move between each others so how does that work let's go in the code a little bit so hopefully it's big enough I think everyone can see it I think so right like but okay so just to give you an example so we're in the container application right now I'm doing web. config the only thing I want to see to show to you guys is the plugins right I don't have mod fation in instantiated why I I told you before about like we're doing a true code so like I said before you have the choice between a string doing a function or you can do a true code so in your case we're doing a true code uh I'm going to just like go a little bit in our source Cod just to you guys to understand what's the setup but I think you'll find it's a very typical like react setup there's nothing very spe special beside uh the um the part about the micr the mod loading other micr phants so you know we have a container we decide hey do you need the header do you need the footer we load the body so if I go into body go to index I'll go here we have S navigation or notification things do you do you need a left bar and then we got we go throughout this and that's where there's a little bit more magic but up to now I think you can also that's like kind a very typical react application nothing very special here so um let's go in routes we will see the route list now so in route list what you'll see is that we actually iterate over navigational items this is the things that or uh teams Define for each of their micro front so if I go for example in here you'll see an example of that so they all go in there and basically when they execute the CI to build the microf is tell them okay go back to container app and just like add your uh list your new micr so you give a p you give where the micr 10 is and the name and with that on our side we're just able to execute what we need to pull your microne for you so uh if you go back here you'll see that okay we have a routes we're doing some authorization and then we do remote micro UI react application and in here is the thing that load all the other micro frontends and again like it looks like a lot and most of this is taken from directly from examples that they provide to do this but the idea is kind of simple still like you'll see like it's just create element script it's going to Lo the remote entry and then with that then it does a little bit of magic uh and this magic is right here so that that's where it becomes a bit more complex basically you do await and it use the window so that's all mod Edition work with your name that you Prov it's like a global variable and then basically you pass whatever modules you want to pull so we're pulling Ro like if that would be button from the example before uh and the setup here is a bit complex so sorry about that but like our idea was like each team can define basically like their fallback like we never like really finish this but in a nutshell it's just like loading this and then executing the module and then returning it uh and then afterwards what we do is we pull the react down for the microf and I'll explain why just a bit faster and then we render it so again it looks like magic but actually it's not very complicated you don't have to do this right doing a react D render you could embed your component directly because it's just it's a module that is for it it could be just a component we don't do it this way and we we have a reason and I'll show just after but it is something that you can do and it's the first thing that we did when we first uh doing this implementation so that's the container have like on the micro setup um I'll show just the web config just to show you what it is um you'll see here we expose two thing like I said we just saw right in the container we expose root we expose react react remote react Dom the react D of this front end application and then if we look at source then it's just like your typical react app so nothing really interesting here so I'll just go in app just to show you but there's nothing specific so it's just like a default border plate for teams to get started and they have you know utils for them to go be more productive things like you know a localize your text use feature kind of kind of thing that like it's all addirect specific stuff that we don't want them to think about it's just there and use

it okay so that was uh or set up so now stuff to think about what do we learn so let's talk first about deployment so I said before like one of the big advantages of micro frontends is that you have independent deployment between whatever you were using before and these new micr contend right this also come with some challenges mainly uh how do you track all your contener app is tracking that your micro frend has been updated like how do you provide this new version of a container app and then redeploy it or to an API like what do you do so at upir we chose the simple way for now I'm not saying we're going to stay with that but I'll show you what we do um and there's some reasons for that I'll just explain uh so what do we do if we go here you'll see that the remote that entry right there is no version so how do we handle that because you know in a perfect world you put that in a CDN you cash it forever and you stop thinking about it and then there's a new version you cash bust it right we're not cash busting it so what we do is we have a cash control no cash so what does the that do well basically uh it doesn't mean that the browser won't cash it but every time you're loading this thing it needs to do a network hop to or CDN to know if there's new version if there's a new version you can pull it from from cash but if there isn't then uh sorry if there's a new version you can pull it from this CDN but if there's not a new version then you can pull it from cach wasn't first but that's what I meant so I'll remove my disable cache and I can show you what I mean right now so if we look at the requests here let's go here sorry you see that yeah there you see the wait for Server response so that's in doing a network hop to the CDN and then doesn't download content because it's already on the brow there's no update on the version so what else you can do well um well that before that it support a promise the promise right so you have a couple of options the first thing you can do is every time you deploy your new micr frend you have some hook some actions uh that will go uh directly in your container code updates on Json file and redeploy the container app so you could do that uh in our case we have eight production clusters so and so the connection between deploying to all the the production clusters and updating the container app because you can update a container app before it's deployed everywhere it's kind of difficult so we didn't want to go with that the other thing you could do uh you after you deploy to a cluster you could have either an Epi updated or a Json file somewhere that exists that you update with versions of your micr so for example you update storefront UI it's just deployed you have a hook that will go into updating that apepi saying okay now your version deployed is

1.01 um and yeah so uh depy other options like that's the one that I've seen most often uh all that to say like I think a good deployment strategy like is a bit more consuming like than we anticipated uh for this setup the other thing to think about is application dependencies so uh I said it before like mod Federation actually uh Magic kind of magically manage pulling all the dependencies needed for for your Federated modules and then tracking that and it's trying a true semantic versioning so you mean if you have two version of react query like this uh it can know if it's not the same the right version of react that's loaded and then pull the new version and then so that your appli still work with its correct dependency um in that's great but it really depends on your setup so what we found out is um at the beginning we really had this setup where the container app was pulling the micr font and it's it's just a component right the microf is a component and it's embedding it in the life cycle of the kind application passing down props and like magic fun fun uh the problem that we got is that I don't like don't control the other teams like some teams use react 17 some teams use react 18 some teams use uh certain dependencies that like do things so what happens if you load uh have a coner in react 17 you have Micro in react 18 well it's going to crash uh you're G to have like weird Behavior like you're breaking the rule of hooks even if you're not breaking sometimes dependencies are embedded inside uh a microf can and you're using the same dependencies embedded in the um in the container app so there's kind of a lot of weird behavior that can happen so what we have to resort to is actually not embedding directly in the life cycle of the container application and uh kind of like just rendering rendering it on Place using the react dump from the micr so that's why we expose the react Dum of the microph because we never know the version of react that this application will use we don't know like it could be anything in the future could be react 19 uh so we pull it from we when we request micr we expose both we expose the app we expose its react D and then can we use the react D to its own code so we're sure that like it always render in the context of how this application was built the cool thing you can do though doing this is that you can share your remote your react dump right so doing that you kind of like foro of the performance issue of like adding like 100k of code uh just to have reactdom available for this

application okay design consistency so that's another one that I've been asked before Al the if like you have 250 engineers in four different offices you don't look at what they do how do you know that they're not doing things that not according to uh your design language right or branding so uh interestingly it wasn't really a problem at abir so and I think it's basically for two reasons one is we have a U library for like four or five years now the designer when they build their UI like that the uh Engineers need to build right they have uh they're like in figma they have their own thing which is 100% align with our company UI Library so for engineers it's really hard to go around and say oh yeah we're we're going to use material design here like you can't like the design from the designer doesn't align with that so having an internal design system like is super critical if you especially if you have a distributed kind of like setup in your organization so that you could you keep like that uh your your style kind of like according to your design language the other thing that we do is that is quite interesting sorry uh is that we this the way where designers are structured so a designer is not part of a product team we have one team that is the ux team that all the designer are are into and basically those designers are kind of a pool of resources that are shared across the company so what does that do well um you're in the checkout team you need

what okay we you are in the checkout team uh you need some design right new UI so you can take a resource from the ux team you're going to work with the product manager and everything but in the background what happens is that as they build this UI uh they go back to the ux team together they look at globally what's happening in the quarter and then uh it means that the ux te one has a global view of everything that so if there's a new UI pattern they paying my team and then we discuss about okay what do we do about this new U UI pattern do we create something new comp library is it the one of or things like that and and the other thing is because they're going back to ux team even the designer canot go like a wire right because it's going to go back the design team the ux team going to look together at the designs that they're building so it kind of make both side kind of align right the ux team and the designers are all aligned the engineers have the company library and then the figma library that the designer used to build their UI uh is based on the company library that we have in react so it makes kind of everything kind of go together okay um last thing server side rendering so it's possible to do Serv during Federation uh there's actually especially with nextjs there is a library to do that that's been authored by the auor model Federation uh there is in my opinion there's two issues with service rendering in model Federation one is uh it's not been something that's been used a lot across the industry so if you have issues it's going to be a bit more difficult to find an answer on those things uh but the biggest issue is kind of the security uh uh security potential so think about it this way so you have modation right uh in the browser so not service side in the browser like if you're CDN get hijacked what can happen so the attacker can get access to your user session do public API call things like that if it the same thing happen on the server side uh on the server so using server side rendering well it's not the same level of thread right they can have potentially access to your server Secrets they can poke around your network they can potentially access your database so uh it's it's quite another thing to uh to do it on the server side uh one thing I would say is that if you want to do it to server side the only way for me that makes sense is that your JavaScript is kind of an internal to your network right so in the browser we don't really care right it's coming from a CDN so like everything is public if you're doing server side rendering with most fation your JavaScript if you want to be secure needs to be your network so if you're your Amazon us you have a network you can put your resources inside your network and it's not accessed outside of your of your network right so nobody can can play with that so that that helps a lot with with this kind of security issues but in my opinion and it's been like a year that it is supported on xjs but I'm still kind of ify about about Serv doing yeah

yeah so uh if you're still doing sad resing for SEO purpose in my opinion like mother Federation not necessarily the best solution for you like if you're doing that it's fine like not saying it's not possible or you shouldn't do it personally I would noly go toward this solution uh Ser running is a great technology like I think nextjs is also a great technology like if you ask me like if I start a new project today and then like I have a small organization you P Engineers or something like that I would you xgs with like something called trpc which allows you to create apis as functions that AR type and then you can have your front end start with your function so there's like a lot of for me like the only thing about mod Federation doesn't really answer your problems in terms of architecture when you're a small team and answer your problem when you have a large organization that is stuck somewhere and then like you don't you're don't finding productivity anymore with your tools that you're having right now and out that helps with that although not saying moderation is not a good architecture like you could build a great architecture today as a small team with Mother Federation like personally it wouldn't be a choice but it is possible um okay so two things about uh if you have to remember about moderation uh in my opinion so first having a good deployment strategy for your micro frontends probably going to be more time consuming that you think like building that like for us like we thought it would be easy at the end of day you saw that solution right it's still kind of like it's not as big but it's not the best it could be like the best would be would be it's stored in the CDN forever and then we do you do cash busting uh the other thing to be careful with if you're using a modation the way it's intended right so you're actually putting modules and using component directly in your app like be careful about your dependencies what we found out like maybe five days into integrating mother Federation is that teams would do things that would break the content reputation and that's why we had to separate the life cycle uh by the way something I didn't say but like the only thing that like we found was an issue with seting the life cycle it's not that but is that one thing you need to be careful is that because we're doing um I'm going to go back sorry just one thing I want to say um if you're doing this uh you need to be really careful all your container app is rendering because if you do this you can't just rer your container app as you want because what is GNA happen I'm gonna have a white flash screen and your micr is going to boot back up right so you can never reboot like this portion of the code if your user is already on the page so you need to be really really careful what you do although like because it's kind of a simple setup for us right we it doesn't do a lot of interaction never been a problem for us but still need to be careful with your state variable there okay uh so micro 10 should you use it uh in my opinion again uh you have a mallet having a hard time sping up you have steam scanning issues and I would definitely recommend you investigate micr mation like all of those things uh can help you greatly uh if you're looking for example of Al mother Federation well I have a very good uh very good answer for you guys the author of mother Federation uh created a ribus story with every case every example possible of what you might want to do using modation so it's super easy to find right it's moderation modation examples you look for modation examples get up whatever you'll find it and I know it's small but like right now what you can see about like like angular to angular different version react angular like every possible way this is all ways you could use mod Federation right now so he created examples for all of that so if you're looking at integrating model Federation you have a use case probably you have an example in there that show the use case that you want to do which is super cool and that's what we use to build or or setup like and even like he's always working on it so we did some updates on or on or setup so we're looking how we can integrate the the ch changes there yeah that's it I'm ready for

questions

y a v ex I think there is one but I think it's it's not super ready but I've seen people doing uh kind of a plugin for V uh for model Federation and I think it's called literally model Federation V or something like that but I'm not sure how much it is on our side like we just use weback because it's more important for us that it's stable than the speed of it but yeah

yes

yeah yeah no uh but we were already set up this way so that was already a problem so uh what we do is that we take for granted that some UI won't be updated that's it yeah yeah so I mean it's a large application like I said some part of still in the Mallet so they have very old UI so for the product manager it's not like out of the blue that like okay some apps are not up to date so that's what we do um if the apps are worked on re regularly right they're going to give receive the update because like we use semantic versioning if they're not work worked on regularly then yeah then they might that out dat what I would say is that we try to not do incremental update but more large updates so we might have like a big update on design system like per year but uh it's not going to be every month we have a new think that we just fix into into somewhere so yep you have a team who's responsible for the micro container yeah that's my team yeah uh although my team is like we're three people so it's not like it's a large team for 250 Engineers uh but uh what we found out is generally um it doesn't take a lot of people once it's built right doesn't take a lot of people to maintain it our idea is that the teams need to be fully independent so they don't need to require us to add micr frontend um the only problem that we have more is around operation we don't have a lot of very deep people of operation that's like probably one of the reason why we still have cash control no cash is because we have a hard time getting the resources to actually fix that problem yep I'm not sure how to to put this question but like in the react don't Factory yeah it's in the in your team right the container um but it decides if it's